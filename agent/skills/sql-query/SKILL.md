---
name: sql-query
description: 生成和执行 SQL 查询以检索业务数据。适用于需要从数据库获取数据、探索表结构、验证查询正确性的场景。委托给 sql-builder-agent 执行。
metadata:
  category: sql
---
## 委托给 sql-builder-agent

所有 SQL 相关操作都委托给 sql-builder-agent 子代理执行。

## 数据库模式探索

**请求模式信息**：
- "请列出数据库中所有可用的表"
- "请显示表 [X] 的模式，包括列、数据类型和关系"

**检查现有文档**：
- 先读取 `/db_schema.md`（如存在）
- 仅在需要时请求新的模式探索

## 查询生成与执行

**提供清晰的业务需求**：
1. **业务问题**：明确要回答的问题
2. **指标**：需要计算的业务指标（收入、订单数、转化率等）
3. **维度**：分组维度（地区、渠道、产品类别等）
4. **筛选条件**：时间范围、状态、类别等
5. **比较需求**：同比、环比、目标对比等

**请求格式示例**：
"我需要按地区比较 2024 年第三季度与 2023 年第三季度的收入。请生成并执行 SQL 查询。"

"请查询过去 6 个月每个月的订单量和平均订单金额，按渠道分组。"

## 接收与验证结果

sql-builder-agent 会返回：
- **SQL 查询**：格式清晰的完整查询
- **查询结果**：返回的数据
- **模式信息**：使用的表结构信息

**验证要点**：
- 查询是否正确回答了业务问题
- 数据质量（NULL 值、异常值）
- 结果完整性（行数、时间范围）
- 列名是否业务友好

## 错误处理

如遇到查询错误：
- 分析错误信息
- 检查表名、列名是否正确
- 验证 JOIN 条件和数据类型
- 请求 sql-builder-agent 修正并重新执行

## 文档化

将使用的 SQL 查询和结果保存到分析文档中，便于后续参考和复现。